import{bw as W,y as X,c as q,b as I,b7 as A,bc as Z,k as S,d as Q,q as G,v as K,r as D,l as ee,w,e as b,g as x,t as te,s as J,h as ne,a as v,u as U}from"./C7zyImg8.js";import{m as O,a as H,b as $,c as M,d as E,e as oe,f as V}from"./1KTiqdsU.js";import{e as k}from"./C8w4AP7O.js";import{u as L}from"./DM1i6pyx.js";import{u as z}from"./Bbe0W9pt.js";function re(t,e){const o=W(t),n=W(e);return+o<+n}function se(t,e){const n=le(t);let r;if(n.date){const a=ue(n.date,2);r=de(a.restDateString,a.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const c=r.getTime();let l=0,d;if(n.time&&(l=pe(n.time),isNaN(l)))return new Date(NaN);if(n.timezone){if(d=me(n.timezone),isNaN(d))return new Date(NaN)}else{const a=new Date(c+l),p=new Date(0);return p.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),p.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),p}return new Date(c+l+d)}const _={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ae=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ie=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ce=/^([+-])(\d{2})(?::?(\d{2}))?$/;function le(t){const e={},o=t.split(_.dateTimeDelimiter);let n;if(o.length>2)return e;if(/:/.test(o[0])?n=o[0]:(e.date=o[0],n=o[1],_.timeZoneDelimiter.test(e.date)&&(e.date=t.split(_.timeZoneDelimiter)[0],n=t.substr(e.date.length,t.length))),n){const r=_.timezone.exec(n);r?(e.time=n.replace(r[1],""),e.timezone=r[1]):e.time=n}return e}function ue(t,e){const o=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=t.match(o);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,c=n[2]?parseInt(n[2]):null;return{year:c===null?r:c*100,restDateString:t.slice((n[1]||n[2]).length)}}function de(t,e){if(e===null)return new Date(NaN);const o=t.match(ae);if(!o)return new Date(NaN);const n=!!o[4],r=T(o[1]),c=T(o[2])-1,l=T(o[3]),d=T(o[4]),a=T(o[5])-1;if(n)return ye(e,d,a)?ve(e,d,a):new Date(NaN);{const p=new Date(0);return!he(e,c,l)||!ge(e,r)?new Date(NaN):(p.setUTCFullYear(e,c,Math.max(r,l)),p)}}function T(t){return t?parseInt(t):1}function pe(t){const e=t.match(ie);if(!e)return NaN;const o=B(e[1]),n=B(e[2]),r=B(e[3]);return Pe(o,n,r)?o*O+n*H+r*1e3:NaN}function B(t){return t&&parseFloat(t.replace(",","."))||0}function me(t){if(t==="Z")return 0;const e=t.match(ce);if(!e)return 0;const o=e[1]==="+"?-1:1,n=parseInt(e[2]),r=e[3]&&parseInt(e[3])||0;return we(n,r)?o*(n*O+r*H):NaN}function ve(t,e,o){const n=new Date(0);n.setUTCFullYear(t,0,4);const r=n.getUTCDay()||7,c=(e-1)*7+o+1-r;return n.setUTCDate(n.getUTCDate()+c),n}const fe=[31,null,31,30,31,30,31,31,30,31,30,31];function Y(t){return t%400===0||t%4===0&&t%100!==0}function he(t,e,o){return e>=0&&e<=11&&o>=1&&o<=(fe[e]||(Y(t)?29:28))}function ge(t,e){return e>=1&&e<=(Y(t)?366:365)}function ye(t,e,o){return e>=1&&e<=53&&o>=0&&o<=6}function Pe(t,e,o){return t===24?e===0&&o===0:o>=0&&o<60&&e>=0&&e<60&&t>=0&&t<25}function we(t,e){return e>=0&&e<=59}const be={},Ce={class:"container"};function De(t,e){return I(),q("div",Ce,[A(t.$slots,"image",{},void 0,!0),A(t.$slots,"description",{class:"description"},void 0,!0)])}const lt=X(be,[["render",De],["__scopeId","data-v-0352bc2f"]]),R=Z("proposition",()=>{const t=S([]),e=S([]),o=S([]),n=S([]);return{serviceEventProposition:t,propositionsSelected:o,professionalServices:n,professionalResponseProposition:e,setServiceEventPropositionForPresta:a=>{t.value=a},setServiceEventPropositionForClient:a=>{e.value=a},setPropositions:a=>{o.value.push(a)},setProfessionalServices:a=>{n.value=a}}}),ut=Q({__name:"PropositionDetails",props:G({selectedProposition:{}},{openPropositionDetail:{default:!1},openPropositionDetailModifiers:{}}),emits:["update:openPropositionDetail"],setup(t){const e=t,o=K(t,"openPropositionDetail");return(n,r)=>{const c=D("v-card-text"),l=D("v-card"),d=D("v-spacer"),a=D("v-btn"),p=D("v-card-actions"),u=D("v-dialog");return I(),ee(u,{modelValue:o.value,"onUpdate:modelValue":r[1]||(r[1]=s=>o.value=s),"max-width":"800"},{default:w(()=>[b(l,null,{default:w(()=>[b(c,null,{default:w(()=>[b(l,null,{default:w(()=>[b(c,null,{default:w(()=>[x(te(e.selectedProposition),1)]),_:1})]),_:1})]),_:1}),b(p,null,{default:w(()=>[b(d),b(a,{text:"",onClick:r[0]||(r[0]=s=>o.value=!1)},{default:w(()=>[...r[2]||(r[2]=[x("Fermer",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Se={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},Me=(t,e,o)=>{let n;const r=Se[t];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",String(e)),o!=null&&o.addSuffix?o.comparison&&o.comparison>0?"dans "+n:"il y a "+n:n},Ee={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},Te={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},je={full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_e={date:$({formats:Ee,defaultWidth:"full"}),time:$({formats:Te,defaultWidth:"full"}),dateTime:$({formats:je,defaultWidth:"full"})},$e={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},Be=(t,e,o,n)=>$e[t],Ne={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},Ue={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},ke={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},Le={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ze={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},Fe=(t,e)=>{const o=Number(t),n=e==null?void 0:e.unit;if(o===0)return"0";const r=["year","week","hour","minute","second"];let c;return o===1?c=n&&r.includes(n)?"ère":"er":c="ème",o+c},We=["MMM","MMMM"],Ae={preprocessor:(t,e)=>t.getDate()===1||!e.some(n=>n.isToken&&We.includes(n.value))?e:e.map(n=>n.isToken&&n.value==="do"?{isToken:!0,value:"d"}:n),ordinalNumber:Fe,era:M({values:Ne,defaultWidth:"wide"}),quarter:M({values:Ue,defaultWidth:"wide",argumentCallback:t=>t-1}),month:M({values:ke,defaultWidth:"wide"}),day:M({values:Le,defaultWidth:"wide"}),dayPeriod:M({values:ze,defaultWidth:"wide"})},xe=/^(\d+)(ième|ère|ème|er|e)?/i,Ie=/\d+/i,Je={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},Oe={any:[/^av/i,/^ap/i]},He={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},Ve={any:[/1/i,/2/i,/3/i,/4/i]},Ye={narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},Re={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},Xe={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},qe={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},Ze={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},Qe={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},Ge={ordinalNumber:oe({matchPattern:xe,parsePattern:Ie,valueCallback:t=>parseInt(t)}),era:E({matchPatterns:Je,defaultMatchWidth:"wide",parsePatterns:Oe,defaultParseWidth:"any"}),quarter:E({matchPatterns:He,defaultMatchWidth:"wide",parsePatterns:Ve,defaultParseWidth:"any",valueCallback:t=>t+1}),month:E({matchPatterns:Ye,defaultMatchWidth:"wide",parsePatterns:Re,defaultParseWidth:"any"}),day:E({matchPatterns:Xe,defaultMatchWidth:"wide",parsePatterns:qe,defaultParseWidth:"any"}),dayPeriod:E({matchPatterns:Ze,defaultMatchWidth:"any",parsePatterns:Qe,defaultParseWidth:"any"})},Ke={code:"fr",formatDistance:Me,formatLong:_e,formatRelative:Be,localize:Ae,match:Ge,options:{weekStartsOn:1,firstWeekContainsDate:4}},dt=t=>{if(!t)return!1;const e=V(new Date,"yyyy-MM-dd");return re(e,t)},pt=t=>t.map(o=>V(se(o),"dd MMM yyyy",{locale:Ke})),mt=t=>{const e=new Date,n=new Date(t).getTime()-e.getTime();return Math.ceil(n/(1e3*3600*24))},et=()=>({mapDtoToEvent:e=>({uuid:e.uuid,organisatorUuid:e.organisatorUuid,isAlreadyCreated:!0,status:e.status,budget:e.budget,location:e.location,people:e.people,name:e.name,date:e.date,eventServices:e.eventServices})}),tt=()=>{const{addError:t,addSuccess:e}=L(),o=k(),n=U(),r=z("token"),{clientProfile:c}=J(ne()),{setEventsByOrganisator:l,setQuestionnaireAnswers:d}=o,a=async f=>{try{const{data:i}=await v.post("http://127.0.0.1:3333/event/create",f,{headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}});if(i)return e("Votre souhait d'évènement a été envoyé avec succès, nous vous mettons en relation avec des partenaires"),c.value&&p(),i}catch{t({message:"Une erreur est survenue lors de l'envoi du message."})}},p=async()=>{const f=S(1),i=[],m=localStorage.getItem("client-uuid");for(;;){const{data:g}=await v.get(`${n.public.apiUrl}/event/list-by-organisator/${m}`,{headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}});if(!g.data.length)break;const{mapDtoToEvent:y}=et(),C=g.data.map(F=>y(F));return i.push(...C),f.value++,l(C),i??[]}};return{createEventService:a,getEventsPerOrganisator:p,getEventsInstance:async f=>{const{data:i}=await v.get(`${n.public.apiUrl}/event/${f}`,{headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}});if(i){const m={...i,isAlreadyCreated:!0};return d(m),m}},getEventServiceList:async f=>{try{const{data:i}=await v.get(`${n.public.apiUrl}/event-service/list-by-event/${f}`,{headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}});return i.data}catch(i){throw t({message:"Impossible d'ajouter le service à l'événement."}),i}},createEventServiceItem:async f=>{try{const{data:i}=await v.post(`${n.public.apiUrl}/event-service/create`,f,{headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}});return i}catch(i){throw t({message:"Impossible d'ajouter le service à l'événement."}),i}}}},nt=()=>{const t=U(),e=z("token"),{addSuccess:o,addError:n}=L();return{getListProfessionalProposition:async u=>{try{const s=await v.get(`${t.public.apiUrl}/event-service-proposition/list-by-professional-service/${u}`,{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(s!=null&&s.data)return s.data.data}catch(s){return console.error("❌ Erreur getListProfessionalProposition:",s),null}},getListEventServiceProposition:async u=>{try{const s=await v.get(`${t.public.apiUrl}/event-service-proposition/${u}/show-event-service-for-professional`,{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(s)return console.log(s.data,"response event service proposition"),s.data}catch(s){return console.error("❌ Erreur getListProfessionalProposition:",s),null}},getListPropositionByEventService:async u=>{try{const s=await v.get(`${t.public.apiUrl}/event-service-proposition/list-by-event-service/${u}`,{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(s!=null&&s.data)return s.data.data}catch(s){return console.error("❌ Erreur getListProfessionalProposition:",s),null}},updateProfessionalMessage:async(u,s)=>{try{const h=await v.patch(`${t.public.apiUrl}/event-service-proposition/accept-by-professional/${u}`,{professionalMessage:s},{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(h)return o("Félicitations, vous vous êtes positionné sur cet évènement"),h}catch(h){return n({message:h.message}),console.error("❌ Erreur getListProfessionalProposition:",h),null}},acceptedByClient:async u=>{console.log("propositionUuid",u);try{const s=await v.patch(`http://127.0.0.1:3333/event-service-proposition/accept-by-organisator/${u}`,{},{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(s)return o("Félicitations, vous venez d'avoir accès au profil prestataire !"),s}catch(s){return n({message:s.message}),console.error("❌ Erreur acceptedByClient:",s),null}},declinedByClient:async u=>{try{const s=await v.patch(`http://127.0.0.1:3333/event-service-proposition/decline-by-organisator/${u}`,{},{headers:{Authorization:`Bearer ${e.value}`,"Content-Type":"application/json"}});if(s)return o("Vous avez décliné cette proposition"),s}catch(s){return n({message:s.message}),console.error("❌ Erreur declinedByClient:",s),null}}}},ot=()=>{const{addError:t}=L(),e=U(),o=z("token"),{setServicesFiltered:n}=k(),{setProfessionalServices:r}=R(),c=localStorage.getItem("professional-uuid");return{getProfessionalService:async()=>{try{const{data:a}=await v.get(`${e.public.apiUrl}/professional-service/show-selected-services-for-professional`,{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});return n(a),a??[]}catch{t({message:"Une erreur est survenue lors de l'envoi du message."})}},getListProfessionalServiceByProfessional:async()=>{console.log(c,"professionalUuid");try{const{data:a}=await v.get(`${e.public.apiUrl}/professional-service/list-by-professional/${c}`,{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});return r(a.data),a.data??[]}catch{t({message:"Une erreur est survenue lors de l'envoi du message."})}}}},N=S(!1),vt=()=>{const{getListProfessionalServiceByProfessional:t}=ot(),{getListProfessionalProposition:e,getListEventServiceProposition:o,getListPropositionByEventService:n,acceptedByClient:r,declinedByClient:c}=nt(),{servicesFiltered:l}=J(k()),{getEventsPerOrganisator:d}=tt(),{setServiceEventPropositionForPresta:a,setServiceEventPropositionForClient:p}=R();return{getServicePropositionForProfessional:async()=>{try{const i=await t();console.log(i,"professionalServices");const g=(await Promise.all(i.map(async y=>{const C=await e(y.uuid);return(await Promise.all(C.map(async P=>{try{const j=await o(P.uuid);return j?{...j,professionalServiceUuid:y.uuid,proposition:{uuid:P.uuid,status:P.status,professionalMessage:P.professionalMessage,tokens:P.tokens}}:(console.warn(`⚠️ Pas d'événement pour la proposition ${P.uuid}`),null)}catch(j){return console.error(`❌ Erreur lors de la récupération de l'événement pour ${P.uuid}:`,j),null}}))).filter(Boolean)}))).flat();console.log(g,"flattenedList"),N.value=g.length>0,a(g)}catch(i){console.error("❌ Erreur getServicePropositionForProfessional:",i),N.value=!1}},propositionAcceptedByClient:async i=>{try{await r(i)}catch(m){console.error("❌ Erreur propositionAcceptedByClient:",m)}},getServicePropositionForClient:async()=>{try{const i=await d();if(!i||i.length===0)return[];const m=await Promise.all(i.map(async g=>{const y=await n(g.eventServices[0].uuid),C=l.value[0].name;return{...y[0],propositionUuid:y[0].uuid,propositionStatus:y[0].status,...g,serviceEngage:C}}));return p(m.flat()),console.log(m.flat()),m.flat()}catch(i){throw console.error("Error fetching service propositions:",i),i}},propositionDeclinedByClient:async i=>{try{await c(i)}catch(m){console.error("❌ Erreur propositionDeclinedByClient:",m)}},servicePropositionAvailable:N}};export{lt as B,ut as _,vt as a,nt as b,tt as c,mt as d,ot as e,pt as f,dt as i,R as u};
