import{i as m,h as w,s as v,b2 as c,u as y}from"./C7zyImg8.js";import{u as k}from"./DM1i6pyx.js";import{u as d}from"./Bbe0W9pt.js";import{u as E}from"./Dtvx2niU.js";const S=()=>{const n=d("token",{maxAge:31104e3,path:"/",sameSite:"strict",secure:!0,httpOnly:!1}),o=d("refreshToken",{default:()=>null,maxAge:3600*24*7,path:"/",sameSite:"strict",secure:!0,httpOnly:!1});return{token:n,refreshToken:o}},z=()=>{const n=y(),o=m(),{addError:t,addSuccess:a}=k(),u=w(),{isStoringUserAccepeted:b}=v(u),{token:l,refreshToken:h}=S(),{setUser:f}=u,g=localStorage.getItem("is-professional"),i=E();return{sendRegister:async s=>{try{const{data:e}=await c.post("http://127.0.0.1:52693/auth/register",s);if(e)return a("Inscription réussie, veuillez vérifier votre email pour confirmer votre compte."),await o.push("/auth/login"),e}catch{t({message:"Veuillez vérifier que le SIRET soit valide."})}},sendLogin:async s=>{var e;try{const{data:r}=await c.post(`${n.public.apiUrl}/auth/login`,s),p=(e=r==null?void 0:r.token)==null?void 0:e.token;if(a("Connexion réussie."),p)h.value=r.refreshToken,l.value=p,f(r.user),console.log(g,"isProfessional- isProfessional"),r.user.category==="consumer"?o.push({path:"/dashboards/dashboard-client"}):o.push({path:"/dashboards/dashboard2"});else throw new Error("Token non reçu du serveur")}catch(r){throw console.error("Login error:",r),t(r),r}},sendLogout:async()=>{try{if(!i)return;const{data:s}=await i.post("/auth/logout");s&&(l.value=null,h.value=null,localStorage.clear(),await o.push("/"),a("Déconnexion réussie."))}catch(s){t(s)}},checkEmail:async s=>{try{const{data:e}=await c.get(`${n.public.apiUrl}/auth/verify-email/${s}`);if(e)return a("Email vérifié avec succès, vous pouvez maintenant vous connecter."),e}catch(e){console.error("Error in checkEmail:",e),t(e)}},sendNewPassword:async s=>{try{const{data:e}=await c.post(`${n.public.apiUrl}/auth/forgot-password`,{email:s});if(e)return a("Un email de réinitialisation de mot de passe a été envoyé."),await o.push("/auth/login"),e}catch(e){t(e)}},registerNewPassword:async s=>{try{if(!i)return;const{data:e}=await i.post("/auth/reset-password",s);if(e)return a("Mot de passe mis à jour avec succès."),await o.push("/auth/login"),e}catch(e){throw console.error("Error in registerNewPassword:",e),t(e),e}}}};export{z as u};
