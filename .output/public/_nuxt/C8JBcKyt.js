import{i as w,h as g,s as v,aD as u,u as k}from"./DFIvP0J7.js";import{u as y}from"./BHfdwCGt.js";import{u as d}from"./DAt_JwB_.js";import{u as E}from"./Be4NXUHw.js";const b=()=>{const o=d("token",{maxAge:31104e3,path:"/",sameSite:"strict",secure:!0,httpOnly:!1}),t=d("refreshToken",{default:()=>null,maxAge:3600*24*7,path:"/",sameSite:"strict",secure:!0,httpOnly:!1});return{token:o,refreshToken:t}},z=()=>{const o=k(),t=w(),{addError:a,addSuccess:n}=y(),c=g(),{isStoringUserAccepeted:T,isProfessional:f}=v(c),{token:l,refreshToken:h}=b(),{setUser:m}=c,i=E();return{sendRegister:async r=>{try{const{data:e}=await u.post(`${o.public.apiUrl}/auth/register`,r);if(e)return n("Inscription réussie, veuillez vérifier votre email pour confirmer votre compte."),await t.push("/auth/login"),e}catch{a({message:"Veuillez vérifier que le SIRET soit valide."})}},sendLogin:async r=>{var e;try{const{data:s}=await u.post(`${o.public.apiUrl}/auth/login`,r),p=(e=s==null?void 0:s.token)==null?void 0:e.token;if(n("Connexion réussie."),p)h.value=s.refreshToken,l.value=p,m(s.user),f.value?t.push({path:"/dashboards/dashboard2"}):t.push({path:"/dashboards/dashboard-client"});else throw new Error("Token non reçu du serveur")}catch(s){throw console.error("Login error:",s),a(s),s}},sendLogout:async()=>{try{if(!i)return;const{data:r}=await i.post("/auth/logout");r&&(n("Déconnexion réussie."),l.value=null,h.value=null,await t.push("/"))}catch(r){a(r)}},checkEmail:async r=>{try{const{data:e}=await u.get(`${o.public.apiUrl}/auth/verify-email/${r}`);if(e)return n("Email vérifié avec succès, vous pouvez maintenant vous connecter."),e}catch(e){console.error("Error in checkEmail:",e),a(e)}},sendNewPassword:async r=>{try{const{data:e}=await u.post(`${o.public.apiUrl}/auth/forgot-password`,{email:r});if(e)return n("Un email de réinitialisation de mot de passe a été envoyé."),await t.push("/auth/login"),e}catch(e){a(e)}},registerNewPassword:async r=>{try{if(!i)return;const{data:e}=await i.post("/auth/reset-password",r);if(e)return n("Mot de passe mis à jour avec succès."),await t.push("/auth/login"),e}catch(e){throw console.error("Error in registerNewPassword:",e),a(e),e}}}};export{z as u};
