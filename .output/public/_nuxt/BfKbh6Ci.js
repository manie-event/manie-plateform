import{u as p}from"./DJAGGwEC.js";import{i as f,h as m,s as v,a as n,u as y}from"./tuwxSyZN.js";import{u as k}from"./Mu8HO9gZ.js";const z=()=>{const c=p("token"),o=y(),t=f(),{addError:a,addSuccess:i}=k(),u=m(),{isStoringUserAccepeted:h,isProfessional:d}=v(u),{setUser:w}=u;return{sendRegister:async r=>{try{const{data:e}=await n.post(`${o.public.apiUrl}/auth/register`,r);if(e)return i("Inscription réussie, veuillez vérifier votre email pour confirmer votre compte."),await t.push("/auth/login"),e}catch{a({message:"Veuillez vérifier que le SIRET soit valide."})}},sendLogin:async r=>{var e;try{const{data:s}=await n.post(`${o.public.apiUrl}/auth/login`,r),l=(e=s==null?void 0:s.token)==null?void 0:e.token;if(i("Connexion réussie."),l&&h.value){const g=p("token",{maxAge:31104e3,path:"/",sameSite:"strict",secure:!0,httpOnly:!1});w(s.user),g.value=l,d.value?t.push({path:"/dashboards/dashboard2"}):t.push({path:"/dashboards/dashboard-client"})}else throw new Error("Token non reçu du serveur")}catch(s){throw console.error("Login error:",s),a(s),s}},sendLogout:async()=>{try{const{data:r}=await n.post(`${o.public.apiUrl}/auth/logout`,{},{headers:{Authorization:`Bearer ${c.value}`,"Content-Type":"application/json"}});r&&(i("Déconnexion réussie."),localStorage.clear(),c.value=null,await t.push("/"))}catch(r){a(r)}},checkEmail:async r=>{try{const{data:e}=await n.get(`${o.public.apiUrl}/auth/verify-email/${r}`);if(e)return i("Email vérifié avec succès, vous pouvez maintenant vous connecter."),e}catch(e){console.error("Error in checkEmail:",e),a(e)}},sendNewPassword:async r=>{try{const{data:e}=await n.post(`${o.public.apiUrl}/auth/forgot-password`,{email:r});if(e)return i("Un email de réinitialisation de mot de passe a été envoyé."),await t.push("/auth/login"),e}catch(e){a(e)}},registerNewPassword:async r=>{try{const{data:e}=await n.post(`${o.public.apiUrl}/auth/reset-password`,r,{headers:{Authorization:`Bearer  ${c.value}`,"Content-Type":"application/json"}});if(e)return i("Mot de passe mis à jour avec succès."),await t.push("/auth/login"),e}catch(e){throw console.error("Error in registerNewPassword:",e),a(e),e}}}};export{z as u};
