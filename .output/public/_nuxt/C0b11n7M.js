import{E as I,k as h,bY as k,D as w,j as P,h as U,s as b,u as A,aD as y}from"./DRerZXE8.js";import{u as C}from"./-XPu_Rvd.js";var j="basil",J=function(e){return e===3?"v3":e},T="https://js.stripe.com",_="".concat(T,"/").concat(j,"/stripe.js"),x=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,q=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var B=function(e){return x.test(e)||q.test(e)},V=function(){for(var e=document.querySelectorAll('script[src^="'.concat(T,'"]')),t=0;t<e.length;t++){var n=e[t];if(B(n.src))return n}return null},E=function(e){var t="",n=document.createElement("script");n.src="".concat(_).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},$=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.8.0",startTime:t})},f=null,m=null,g=null,D=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},G=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},N=function(e){return f!==null?f:(f=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var r=V();if(!(r&&e)){if(!r)r=E(e);else if(r&&g!==null&&m!==null){var i;r.removeEventListener("load",g),r.removeEventListener("error",m),(i=r.parentNode)===null||i===void 0||i.removeChild(r),r=E(e)}}g=G(t,n),m=D(n),r.addEventListener("load",g),r.addEventListener("error",m)}catch(l){n(l);return}}),f.catch(function(t){return f=null,Promise.reject(t)}))},O=function(e,t,n){if(e===null)return null;var r=t[0],i=r.match(/^pk_test/),l=J(e.version),c=j;i&&l!==c&&console.warn("Stripe.js@".concat(l," was loaded on the page, but @stripe/stripe-js@").concat("7.8.0"," expected Stripe.js@").concat(c,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var S=e.apply(void 0,t);return $(S,n),S},v,R=!1,L=function(){return v||(v=N(null).catch(function(e){return v=null,Promise.reject(e)}),v)};Promise.resolve().then(function(){return L()}).catch(function(o){R||console.warn(o)});var W=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R=!0;var r=Date.now();return L().then(function(i){return O(i,t,r)})};const z=I("cartStore",()=>{const o=h(0),e=k("jeton-quantity",0),t=h([]),n=w(()=>9*e.value),r=w(()=>e.value);return{cartQuantity:e,addresses:t,getCart:r,userTokenBalance:o,getTotalPrice:n,setBillingInfo:c=>{t.value.push(c)},creditTokensAfterPayment:c=>{o.value=o.value+c}}}),K=()=>{const o=C("token"),e=P(),t=A(),n=U(),{professionalUser:r}=b(n),i=z(),{creditTokensAfterPayment:l}=i;W(t.public.tokenStripe);const c=async u=>{var p;const a=r.value,d=u;if(localStorage.setItem("professional-uuid",((p=a==null?void 0:a.uuid)==null?void 0:p.replace(/[""]/g,""))||""),localStorage.setItem("token-session",o.value||""),!(a!=null&&a.uuid)){console.error("❌ No professional profile found");return}try{localStorage.setItem("jeton-quantity",JSON.stringify(d)),console.log(a,"from createTokenSession");const{data:s}=await y.post(`${t.public.apiUrl}/payments/token/${a.uuid}`,{quantity:u,professional_uuid:a.uuid},{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});if(s&&s.url)return window.location.href=s.url,console.log(window.location.href,"REDIRECT STRIPE"),s}catch(s){throw s}},S=async(u,a)=>{console.log("Creating jetons...",u,a);try{const{data:d}=await y.post(`${t.public.apiUrl}/credit/create`,{quantity:u,professionalUuid:a},{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});if(d)return localStorage.removeItem("jeton-quantity"),d}catch(d){console.log(d)}};return{createTokenSession:c,restoreAfterStripe:async u=>{localStorage.setItem("user-category","professional");const a=new URLSearchParams(window.location.search);if(a.has("session_id")||a.has("payment_intent")||e.query.success){const p=localStorage.getItem("jeton-quantity");try{if(p){const s=JSON.parse(p);l(s),u.uuid&&(console.log("✅ Restoring profile and creating tokens"),await S(s,u.uuid))}}catch(s){console.warn("LocalStorage restore failed:",s)}console.error("❌ All restore attempts failed")}else console.log("✅ Profile déjà présent, aucun besoin restock ")}}},M=""+new URL("jeton.D2Zd9_FU.png",import.meta.url).href;export{M as J,K as a,z as u};
