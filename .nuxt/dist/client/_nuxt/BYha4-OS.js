import{B as T,l,A as g,j as P,k as U,i as b,s as I,at as A,c3 as y}from"./CHEumwGj.js";import{u as C}from"./BqfPwIYT.js";const N=""+new URL("jeton.D2Zd9_FU.png",import.meta.url).href,O=T("cartStore",()=>{const o=l({name:"Jeton Manie",price:9,quantity:0}),e=l([]),r=g(()=>o.value.price*o.value.quantity),n=g(()=>o.value);return{cart:o,addresses:e,getCart:n,getTotalPrice:r,setJetonAmount:i=>{o.value.quantity=i},setBillingInfo:i=>{e.value.push(i)}}});var E="basil",J=function(e){return e===3?"v3":e},j="https://js.stripe.com",k="".concat(j,"/").concat(E,"/stripe.js"),x=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,_=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var q=function(e){return x.test(e)||_.test(e)},V=function(){for(var e=document.querySelectorAll('script[src^="'.concat(j,'"]')),r=0;r<e.length;r++){var n=e[r];if(q(n.src))return n}return null},w=function(e){var r="",n=document.createElement("script");n.src="".concat(k).concat(r);var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(n),n},$=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.6.1",startTime:r})},d=null,f=null,m=null,B=function(e){return function(r){e(new Error("Failed to load Stripe.js",{cause:r}))}},G=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},D=function(e){return d!==null?d:(d=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var t=V();if(!(t&&e)){if(!t)t=w(e);else if(t&&m!==null&&f!==null){var a;t.removeEventListener("load",m),t.removeEventListener("error",f),(a=t.parentNode)===null||a===void 0||a.removeChild(t),t=w(e)}}m=G(r,n),f=B(n),t.addEventListener("load",m),t.addEventListener("error",f)}catch(i){n(i);return}}),d.catch(function(r){return d=null,Promise.reject(r)}))},W=function(e,r,n){if(e===null)return null;var t=r[0],a=t.match(/^pk_test/),i=J(e.version),u=E;a&&i!==u&&console.warn("Stripe.js@".concat(i," was loaded on the page, but @stripe/stripe-js@").concat("7.6.1"," expected Stripe.js@").concat(u,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var S=e.apply(void 0,r);return $(S,n),S},v,R=!1,L=function(){return v||(v=D(null).catch(function(e){return v=null,Promise.reject(e)}),v)};Promise.resolve().then(function(){return L()}).catch(function(o){R||console.warn(o)});var z=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];R=!0;var t=Date.now();return L().then(function(a){return W(a,r,t)})};const K=()=>{const o=C("token");P(),U();const e=A(),r=b(),{professionalUser:n}=I(r),t=l(!1),a=l(""),i=l(!1),u=l();return z(e.public.tokenStripe),{createTokenSession:async p=>{var s,h;console.log(p,"amount");try{const{data:c}=await y.post(`${e.public.apiUrl}/payments/token/${(s=n.value)==null?void 0:s.uuid}`,{quantity:p,professional_uuid:(h=n.value)==null?void 0:h.uuid},{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});c&&c.url&&(window.location.href=c.url)}catch(c){throw console.error("Error creating token session:",c),c}},verifyPayment:async p=>{console.log(p,"session_id");try{t.value=!0;const{data:s}=await y.get(`${e.public.apiUrl}/payments/session-status/${p}`,{headers:{Authorization:`Bearer ${o.value}`,"Content-Type":"application/json"}});s.success?(console.log(s),i.value=!0,u.value=s.session,console.log(u.value,"paymentData")):a.value=s.error||"Échec de la vérification"}catch(s){console.error("Erreur lors de la vérification:",s),a.value="Erreur de communication avec le serveur"}finally{t.value=!1}},loading:t,messageError:a,paymentVerified:i,paymentData:u}};export{N as J,K as a,O as u};
