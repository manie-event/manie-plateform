import{i as m,h as w,s as v,b5 as c,u as k}from"./Y2cM3ybq.js";import{u as y}from"./BmmcoTAk.js";import{u as f}from"./yA45zEN9.js";import{u as b}from"./D3kLc0Nx.js";const E=()=>{const t=f("token",{maxAge:31104e3,path:"/",sameSite:"strict",secure:!0,httpOnly:!1}),o=f("refreshToken",{default:()=>null,maxAge:3600*24*7,path:"/",sameSite:"strict",secure:!0,httpOnly:!1});return{token:t,refreshToken:o}},z=()=>{const t=k(),o=m(),{addError:a,addSuccess:n}=y(),u=w(),{isStoringUserAccepeted:P}=v(u),{token:l,refreshToken:h}=E(),{setUser:g}=u,p=localStorage.getItem("is-professional"),i=b();return{sendRegister:async s=>{try{const{data:e}=await c.post(`${t.public.apiUrl}/auth/register`,s);if(e)return n("Inscription réussie, veuillez vérifier votre email pour confirmer votre compte."),await o.push("/auth/login"),e}catch{a({message:"Veuillez vérifier que le SIRET soit valide."})}},sendLogin:async s=>{var e;try{const{data:r}=await c.post(`${t.public.apiUrl}/auth/login`,s),d=(e=r==null?void 0:r.token)==null?void 0:e.token;if(n("Connexion réussie."),d)h.value=r.refreshToken,l.value=d,g(r.user),console.log(p,"isProfessional- isProfessional"),p?o.push({path:"/dashboards/dashboard2"}):o.push({path:"/dashboards/dashboard-client"});else throw new Error("Token non reçu du serveur")}catch(r){throw console.error("Login error:",r),a(r),r}},sendLogout:async()=>{try{if(!i)return;const{data:s}=await i.post("/auth/logout");s&&(n("Déconnexion réussie."),l.value=null,h.value=null,await o.push("/"))}catch(s){a(s)}},checkEmail:async s=>{try{const{data:e}=await c.get(`${t.public.apiUrl}/auth/verify-email/${s}`);if(e)return n("Email vérifié avec succès, vous pouvez maintenant vous connecter."),e}catch(e){console.error("Error in checkEmail:",e),a(e)}},sendNewPassword:async s=>{try{const{data:e}=await c.post(`${t.public.apiUrl}/auth/forgot-password`,{email:s});if(e)return n("Un email de réinitialisation de mot de passe a été envoyé."),await o.push("/auth/login"),e}catch(e){a(e)}},registerNewPassword:async s=>{try{if(!i)return;const{data:e}=await i.post("/auth/reset-password",s);if(e)return n("Mot de passe mis à jour avec succès."),await o.push("/auth/login"),e}catch(e){throw console.error("Error in registerNewPassword:",e),a(e),e}}}};export{z as u};
