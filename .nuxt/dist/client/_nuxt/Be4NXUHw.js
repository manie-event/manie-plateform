import{aD as c,u as p,a8 as f}from"./DFIvP0J7.js";import{u as h}from"./DAt_JwB_.js";let r=null;const m=()=>{const u=p();if(!r){const n=h("refreshToken"),a=h("token");r=c.create({baseURL:u.public.apiUrl}),r.interceptors.request.use(e=>(a.value&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${a.value}`),e),e=>Promise.reject(e)),r.interceptors.response.use(e=>e,async e=>{var i;const o=e.config;if(((i=e.response)==null?void 0:i.status)===401&&n.value&&!o._retry){o._retry=!0;try{const t=await c.post(`${u.public.apiUrl}/auth/refresh-token`,{refreshToken:n.value},{headers:{Authorization:`Bearer ${a.value}`,"Content-Type":"application/json"}});if(t.data){const s=t.data.accessToken.token,l=t.data.refreshToken;if(s!=null&&s.value&&l)return a.value=s.value,n.value=l,o.headers.Authorization=`Bearer ${s.value}`,r.request(o)}}catch(t){return a.value=null,n.value=null,await f("/auth/login"),Promise.reject(t)}}return Promise.reject(e)})}return r};export{m as u};
